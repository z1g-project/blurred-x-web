"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[235],{1235:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var n=r(7568),i=r(922),s=r(6740);class o{get(e){var t=this;return(0,n.Z)(function*(){t.password&&(e.includes("?")?e+="&pwd="+t.password:e+="?pwd="+t.password);try{let r=yield fetch(new URL(e,t.server),{signal:t.signal});if(200===r.status)return yield r.text();throw Error(`unexpected server response to not match "200". Server says "${yield r.text()}"`)}catch(n){throw console.error(n),Error("Cannot communicate with the server")}})()}needPassword(){var e=this;return(0,n.Z)(function*(){return(yield e.get("needpassword"))==="true"})()}newSession(){var e=this;return(0,n.Z)(function*(){return yield e.get("newsession")})()}editSession(e,t,r){var i=this;return(0,n.Z)(function*(){let n=yield i.get("editsession?id="+encodeURIComponent(e)+(t?"&httpProxy="+encodeURIComponent(t):"")+"&enableShuffling="+(r?"1":"0"));if("Success"!==n)throw Error(`unexpected response from server. received ${n}`)})()}sessionExists(e){var t=this;return(0,n.Z)(function*(){let r=yield t.get("sessionexists?id="+encodeURIComponent(e));switch(r){case"exists":return!0;case"not found":return!1;default:throw Error(`unexpected response from server. received ${r}`)}})()}deleteSession(e){var t=this;return(0,n.Z)(function*(){if(yield t.sessionExists(e)){let r=yield t.get("deletesession?id="+e);if("Success"!==r&&"not found"!==r)throw Error(`unexpected response from server. received ${r}`)}})()}shuffleDict(e){var t=this;return(0,n.Z)(function*(){let r=yield t.get("api/shuffleDict?id="+encodeURIComponent(e));return JSON.parse(r)})()}constructor(e,t,r){this.server=e,this.signal=t,this.password=r}}class a{mod(e,t){return(e%t+t)%t}generateDictionary(){let e="",t=this.baseDictionary.split("");for(;t.length>0;)e+=t.splice(Math.floor(Math.random()*t.length),1)[0];return e}shuffle(e){if(e.startsWith(this.shuffledIndicator))return e;let t="";for(let r=0;r<e.length;r++){let n=e.charAt(r),i=this.baseDictionary.indexOf(n);"%"===n&&e.length-r>=3?t+=n+e.charAt(++r)+e.charAt(++r):-1===i?t+=n:t+=this.dictionary.charAt(this.mod(i+r,this.baseDictionary.length))}return this.shuffledIndicator+t}unshuffle(e){if(!e.startsWith(this.shuffledIndicator))return e;e=e.slice(this.shuffledIndicator.length);let t="";for(let r=0;r<e.length;r++){let n=e.charAt(r),i=this.dictionary.indexOf(n);"%"===n&&e.length-r>=3?t+=n+e.charAt(++r)+e.charAt(++r):-1===i?t+=n:t+=this.baseDictionary.charAt(this.mod(i-r,this.baseDictionary.length))}return t}constructor(e){this.baseDictionary="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~-",this.shuffledIndicator="_rhs",e||(e=this.generateDictionary()),this.dictionary=e}}var c=r(2539),l=r(5240);/*! js-cookie v3.0.1 | MIT */function d(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var h=function e(t,r){function n(e,n,i){if("undefined"!=typeof document){"number"==typeof(i=d({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var o in i)i[o]&&(s+="; "+o,!0!==i[o]&&(s+="="+i[o].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+s}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},i=0;i<r.length;i++){var s=r[i].split("="),o=s.slice(1).join("=");try{var a=decodeURIComponent(s[0]);if(n[a]=t.read(o,a),e===a)break}catch(c){}}return e?n[e]:n}},remove:function(e,t){n(e,"",d({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,d({},this.attributes,t))},withConverter:function(t){return e(d({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),u=r(4051),f=r(360),p=r(6732);let m=({compatLayout:e})=>{let{t}=(0,f.$G)("compat"),d=(0,p.TH)();return(0,u.useEffect)(()=>{(0,n.Z)(function*(){let t;try{let n=new o(c.Fb);if(h.set("auth_proxy","1",{domain:`.${r.g.location.host}`,expires:6048e5,secure:"https:"===r.g.location.protocol,sameSite:"lax"}),h.set("origin_proxy",r.g.location.origin,{expires:6048e5,secure:"https:"===r.g.location.protocol,sameSite:"lax"}),t=l.ZP.t("compat:error.unreachable",{what:"Rammerhead"}),yield fetch(c.Fb),t=void 0,t=l.ZP.t("compat:error.rammerheadSavedSession"),localStorage.rammerhead_session&&(yield n.sessionExists(localStorage.rammerhead_session))){let i=yield fetch(new URL(localStorage.rammerhead_session,c.Fb));yield n.deleteSession(localStorage.rammerhead_session),403===i.status&&delete localStorage.rammerhead_session}else delete localStorage.rammerhead_session;t=l.ZP.t("compat:error.rammerheadNewSession");let u=localStorage.rammerhead_session||(yield n.newSession());t=void 0,t=void 0,t=l.ZP.t("compat:error.rammerheadEditSession"),yield n.editSession(u,!1,!0),t=void 0,t=l.ZP.t("compat:error.rammerheadDict");let f=yield n.shuffleDict(u);t=void 0;let p=new a(f);r.g.location.replace(new URL(`${u}/${p.shuffle((0,s.Y3)(d)).replace(/(^.*?:\/)\//,"$1")}`,c.Fb))}catch(m){e.current.report(m,t,"Rammerhead")}})()},[e,d]),(0,i.jsx)("main",{children:t("loading",{what:"Rammerhead"})})};var g=m}}]);
//# sourceMappingURL=235.94509793.chunk.js.map