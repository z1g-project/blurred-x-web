{"version":3,"file":"static/js/564.266d829c.chunk.js","mappings":"0MA0BA,IAAMA,EAAwB,CAAC,CAAEC,aAAAA,CAAY,CAAE,GAAK,CACnD,GAAM,CAAEC,EAAAA,CAAC,CAAE,CAAGC,CAAAA,EAAAA,EAAAA,EAAAA,EAAe,UAEvBC,EAAWC,CAAAA,EAAAA,EAAAA,MAAAA,EAA0B,IAAI,EACzCC,EAAWC,CAAAA,EAAAA,EAAAA,EAAAA,IAsDjB,MApDAC,CAAAA,EAAAA,EAAAA,SAAAA,EAAU,IAAM,CACf,CAAC,EAAD,KAAC,WAAkB,KAGdC,EAFJ,GAAI,EAAcC,OAAO,EAAKN,EAASM,OAAO,CAI9C,GAAI,CACH,GAAI,CAACC,EAAAA,EAAcA,CAElB,MADAF,EAAaG,EAAAA,EAAAA,CAAAA,CAAM,CAAC,wBACd,MAAUH,EAAY,CAC5B,GAEG,CAACI,UAAUC,aAAa,CAE3B,MADAL,EAAaG,EAAAA,EAAAA,CAAAA,CAAM,CAAC,0BACd,MAAUH,EAAY,CAC5B,EAEYG,EAAAA,EAAAA,CAAAA,CAAM,CAAC,wBACpB,MAAMR,EAASM,OAAO,CAACK,OAAO,CAC9BN,EAAaO,KAAAA,EAEb,IAAMC,EAASC,YAGfT,EAAaG,EAAAA,EAAAA,CAAAA,CAAM,CAAC,8BACpB,MAAMC,UAAUC,aAAa,CAACK,QAAQ,CAACC,EAAAA,EAAWA,CAAG,YAAa,CACjEC,MAAOJ,EAAOK,MAAM,CACpBC,eAAgB,MACjB,GACAd,EAAaO,KAAAA,EAEbP,EAAaG,EAAAA,EAAAA,CAAAA,CAAM,CAAC,2BAA4B,CAAEY,KAAM,MAAO,EAC/D,EACC,IAAMC,EAAO,MAAMC,MAAMC,EAAAA,EAAQA,EACjC,GAAI,CAACF,EAAKG,EAAE,CACX,MAAM,MAAMH,EAAKI,IAAI,EAAG,CAG1BpB,EAAaO,KAAAA,EAEbc,EAAAA,CAAMA,CAACxB,QAAQ,CAACyB,OAAO,CACtB,IAAIC,IACHf,EAAOgB,SAAS,CAACC,CAAAA,EAAAA,EAAAA,EAAAA,EAAe5B,IAChC,IAAI0B,IAAIf,EAAOK,MAAM,CAAEQ,EAAAA,CAAMA,CAACxB,QAAQ,CAAC6B,QAAQ,KAGlD,CAAE,MAAOC,EAAK,CACbnC,EAAaS,OAAO,CAAC2B,MAAM,CAACD,EAAK3B,EAAY,cAC9C,CA5CA,IA8CF,EAAG,CAACR,EAAcK,EAAS,EAG1B,WAACgC,OAAAA,CAAAA,SAAAA,CACA,WAACC,EAAAA,EAAOA,CAAAA,CAACC,IAAKpC,EAAAA,SAAAA,CACb,UAACqC,EAAAA,EAAMA,CAAAA,CAACC,IAAKtB,EAAAA,EAAWA,CAAG,qBAC3B,UAACqB,EAAAA,EAAMA,CAAAA,CAACC,IAAKtB,EAAAA,EAAWA,CAAG,wBAE3BlB,EAAE,UAAW,CAAEsB,KAAM,aAAc,KAGvC,CAEA,WAAexB,C","sources":["webpack://website/./src/pages/compat/ultraviolet.tsx"],"sourcesContent":["import type { HolyPage } from '../../App';\nimport type { ScriptsRef } from '../../CompatLayout';\nimport { getDestination, Script, Scripts } from '../../CompatLayout';\nimport { BARE_API, SERVICEWORKERS } from '../../consts';\nimport i18n from '../../i18n';\nimport { PUBLIC_PATH } from '../../routes';\nimport { useEffect, useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useLocation } from 'react-router-dom';\n\ntype UVEncode = (encoded: string) => string;\ntype UVDecode = (encoded: string) => string;\n\ninterface UVConfig {\n\tbare: string;\n\tprefix: string;\n\thandler: string;\n\tbundle: string;\n\tconfig: string;\n\tsw: string;\n\tencodeUrl: UVEncode;\n\tdecodeUrl: UVDecode;\n}\n\ndeclare const __uv$config: UVConfig;\n\nconst Ultraviolet: HolyPage = ({ compatLayout }) => {\n\tconst { t } = useTranslation('compat');\n\n\tconst uvBundle = useRef<ScriptsRef | null>(null);\n\tconst location = useLocation();\n\n\tuseEffect(() => {\n\t\t(async function () {\n\t\t\tif (!compatLayout.current || !uvBundle.current) return;\n\n\t\t\tlet errorCause: string | undefined;\n\n\t\t\ttry {\n\t\t\t\tif (!SERVICEWORKERS) {\n\t\t\t\t\terrorCause = i18n.t('compat:error.swHTTPS');\n\t\t\t\t\tthrow new Error(errorCause);\n\t\t\t\t}\n\n\t\t\t\tif (!navigator.serviceWorker) {\n\t\t\t\t\terrorCause = i18n.t('compat:error.swSupport');\n\t\t\t\t\tthrow new Error(errorCause);\n\t\t\t\t}\n\n\t\t\t\terrorCause = i18n.t('compat:error.generic');\n\t\t\t\tawait uvBundle.current.promise;\n\t\t\t\terrorCause = undefined;\n\n\t\t\t\tconst config = __uv$config;\n\n\t\t\t\t// register sw\n\t\t\t\terrorCause = i18n.t('compat:error.registeringSW');\n\t\t\t\tawait navigator.serviceWorker.register(PUBLIC_PATH + '/uv/sw.js', {\n\t\t\t\t\tscope: config.prefix,\n\t\t\t\t\tupdateViaCache: 'none',\n\t\t\t\t});\n\t\t\t\terrorCause = undefined;\n\n\t\t\t\terrorCause = i18n.t('compat:error.unreachable', { what: 'Bare' });\n\t\t\t\t{\n\t\t\t\t\tconst bare = await fetch(BARE_API);\n\t\t\t\t\tif (!bare.ok) {\n\t\t\t\t\t\tthrow await bare.json();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\terrorCause = undefined;\n\n\t\t\t\tglobal.location.replace(\n\t\t\t\t\tnew URL(\n\t\t\t\t\t\tconfig.encodeUrl(getDestination(location)),\n\t\t\t\t\t\tnew URL(config.prefix, global.location.toString())\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t} catch (err) {\n\t\t\t\tcompatLayout.current.report(err, errorCause, 'Ultraviolet');\n\t\t\t}\n\t\t})();\n\t}, [compatLayout, location]);\n\n\treturn (\n\t\t<main>\n\t\t\t<Scripts ref={uvBundle}>\n\t\t\t\t<Script src={PUBLIC_PATH + '/uv/uv.bundle.js'} />\n\t\t\t\t<Script src={PUBLIC_PATH + '/uv/uv.config.js'} />\n\t\t\t</Scripts>\n\t\t\t{t('loading', { what: 'Ultraviolet' })}\n\t\t</main>\n\t);\n};\n\nexport default Ultraviolet;\n"],"names":["Ultraviolet","compatLayout","t","useTranslation","uvBundle","useRef","location","useLocation","useEffect","errorCause","current","SERVICEWORKERS","i18n","navigator","serviceWorker","promise","undefined","config","__uv$config","register","PUBLIC_PATH","scope","prefix","updateViaCache","what","bare","fetch","BARE_API","ok","json","global","replace","URL","encodeUrl","getDestination","toString","err","report","main","Scripts","ref","Script","src"],"sourceRoot":""}