{"version":3,"file":"static/js/852.372fe87d.chunk.js","mappings":"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","sources":["webpack://website/./src/pages/settings/tabcloak.tsx","webpack://website/./node_modules/@mui/icons-material/Check.js"],"sourcesContent":["import type { HolyPage } from '../../App';\nimport { useGlobalCloakSettings } from '../../Layout';\nimport Meta from '../../Meta';\nimport { Notification } from '../../Notifications';\nimport { ThemeButton, ThemeInputBar, themeStyles } from '../../ThemeElements';\nimport { BARE_API } from '../../consts';\nimport i18n from '../../i18n';\nimport { Obfuscated } from '../../obfuscate';\nimport styles from '../../styles/Settings.module.scss';\nimport Check from '@mui/icons-material/Check';\nimport BareClient from '@tomphttp/bare-client';\nimport clsx from 'clsx';\nimport { useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nconst bare = new BareClient(BARE_API);\n\ninterface ExtractedData {\n\ttitle: string;\n\ticon: string;\n\turl: string;\n}\n\nasync function extractData(url: string): Promise<ExtractedData> {\n\tconst response = await bare.fetch(url, { redirect: 'follow' });\n\n\tif (!response.ok)\n\t\tthrow new Error(\n\t\t\ti18n.t('settings:tabCloak.error.response', { status: response.status })\n\t\t);\n\n\tconst parser = new DOMParser();\n\n\tconst dom = parser.parseFromString(`${await response.text()}`, 'text/html');\n\n\tconst base = document.createElement('base');\n\tbase.href = url;\n\n\tdom.head.append(base);\n\n\tlet icon: string;\n\n\tconst iconSelector = dom.querySelector(\n\t\t'link[rel*=\"icon\"]'\n\t) as HTMLLinkElement | null;\n\n\tif (iconSelector && iconSelector.href !== '') icon = iconSelector.href;\n\telse icon = new URL('/favicon.ico', url).toString();\n\n\tconst outgoing = await bare.fetch(icon);\n\n\ticon = await blobToDataURL(\n\t\tnew Blob([await outgoing.arrayBuffer()], {\n\t\t\ttype: outgoing.headers.get('content-type')!,\n\t\t})\n\t);\n\n\tconst titleSelector = dom.querySelector('title');\n\n\tlet title: string;\n\n\tif (titleSelector && titleSelector.textContent !== '')\n\t\ttitle = titleSelector.textContent!;\n\telse {\n\t\tconst url = new URL(response.finalURL);\n\t\ttitle = `${url.host}${url.pathname}${url.search}`;\n\t}\n\n\treturn { icon, title, url: response.finalURL };\n}\n\nconst whitespace = /\\s+/;\nconst protocol = /^\\w+:/;\n\nfunction resolveURL(input: string) {\n\tif (input.match(protocol)) {\n\t\treturn input;\n\t} else if (input.includes('.') && !input.match(whitespace)) {\n\t\treturn `http://${input}`;\n\t} else {\n\t\tthrow new Error(i18n.t('settings:tabCloak.error.validate'));\n\t}\n}\n\nasync function blobToDataURL(blob: Blob) {\n\tconst reader = new FileReader();\n\n\treturn new Promise<string>((resolve, reject) => {\n\t\treader.addEventListener('load', () => resolve(reader.result as string));\n\t\treader.addEventListener('error', reject);\n\t\treader.readAsDataURL(blob);\n\t});\n}\n\nconst TabCloakMeta = () => <Meta title=\"Tab Cloak Settings\" />;\n\nconst TabCloak: HolyPage = ({ layout }) => {\n\tconst { t } = useTranslation(['settings', 'commonError']);\n\tconst [cloak, setCloak] = useGlobalCloakSettings();\n\tconst input = useRef<HTMLInputElement | null>(null);\n\n\tasync function onSubmit() {\n\t\ttry {\n\t\t\tconst resolved = resolveURL(input.current!.value);\n\n\t\t\tlet title, icon, url;\n\n\t\t\tswitch (resolved) {\n\t\t\t\tcase 'about:blank':\n\t\t\t\t\ttitle = 'about:blank';\n\t\t\t\t\ticon = 'none';\n\t\t\t\t\turl = 'about:blank';\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlayout.current!.notifications.current!.add(\n\t\t\t\t\t\t<Notification\n\t\t\t\t\t\t\tdescription={t('settings:tabCloak.notification.fetching')}\n\t\t\t\t\t\t\ttype=\"info\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\n\t\t\t\t\t({ title, icon, url } = await extractData(resolved));\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tinput.current!.value = url;\n\n\t\t\tsetCloak({\n\t\t\t\ttitle: title!,\n\t\t\t\ticon: icon!,\n\t\t\t\turl: url!,\n\t\t\t});\n\n\t\t\tlayout.current!.notifications.current!.add(\n\t\t\t\t<Notification\n\t\t\t\t\tdescription={t('settings:tabCloak.notification.set')}\n\t\t\t\t\ttype=\"success\"\n\t\t\t\t/>\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\n\t\t\tlayout.current!.notifications.current!.add(\n\t\t\t\t<Notification\n\t\t\t\t\ttitle={t('settings:tabCloak.notification.failure')}\n\t\t\t\t\tdescription={\n\t\t\t\t\t\terr instanceof Error\n\t\t\t\t\t\t\t? err.message\n\t\t\t\t\t\t\t: (i18n.t('commonError:unknownError') as string)\n\t\t\t\t\t}\n\t\t\t\t\ttype=\"error\"\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<TabCloakMeta />\n\t\t\t<section>\n\t\t\t\t<p>\n\t\t\t\t\t<Obfuscated>{t('settings:tabCloak.description')}</Obfuscated>\n\t\t\t\t</p>\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<Obfuscated>{t('settings:tabCloak.urlField')}</Obfuscated>:\n\t\t\t\t\t</p>\n\t\t\t\t\t<form\n\t\t\t\t\t\tonSubmit={(event) => {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tonSubmit();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ThemeInputBar className={styles.ThemeInputBar}>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclassName={themeStyles.themePadRight}\n\t\t\t\t\t\t\t\tdefaultValue={cloak.url}\n\t\t\t\t\t\t\t\tplaceholder=\"https://example.org/\"\n\t\t\t\t\t\t\t\tref={input}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Check\n\t\t\t\t\t\t\t\tonClick={onSubmit}\n\t\t\t\t\t\t\t\tclassName={clsx(themeStyles.button, themeStyles.right)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</ThemeInputBar>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<ThemeButton\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tsetCloak({\n\t\t\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\t\t\ticon: '',\n\t\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tinput.current!.value = '';\n\n\t\t\t\t\t\t\tlayout.current!.notifications.current!.add(\n\t\t\t\t\t\t\t\t<Notification\n\t\t\t\t\t\t\t\t\tdescription={t('settings:tabCloak.notification.reset')}\n\t\t\t\t\t\t\t\t\ttype=\"info\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Obfuscated>{t('settings:tabCloak.resetButton')}</Obfuscated>\n\t\t\t\t\t</ThemeButton>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t</>\n\t);\n};\n\nexport default TabCloak;\n","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"\n}), 'Check');\nexports.default = _default;"],"names":["bare","BareClient","BARE_API","extractData","url","icon","title","response","fetch","redirect","ok","i18n","status","parser","DOMParser","dom","parseFromString","text","base","document","createElement","href","head","append","iconSelector","querySelector","URL","toString","outgoing","blobToDataURL","blob","Blob","arrayBuffer","type","headers","get","titleSelector","textContent","finalURL","host","pathname","search","whitespace","protocol","reader","FileReader","Promise","resolve","reject","addEventListener","result","readAsDataURL","TabCloakMeta","Meta","TabCloak","layout","t","useTranslation","cloak","setCloak","useGlobalCloakSettings","input","useRef","onSubmit","resolved","resolveURL","match","includes","current","value","notifications","add","Notification","description","err","console","error","Error","message","section","p","Obfuscated","div","form","event","preventDefault","ThemeInputBar","className","styles","themeStyles","defaultValue","placeholder","ref","Check","onClick","clsx","ThemeButton","_interopRequireDefault","require","exports","_createSvgIcon","_jsxRuntime","_default","default","jsx","d"],"sourceRoot":""}